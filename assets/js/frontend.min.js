var WC_PPP_Brasil_Checkout=function(){function e(){var e=this;this.onSubmitForm=function(t){var a=jQuery("#payment_method_"+wc_ppp_brasil_data.id+":checked");wc_ppp_brasil_data.order_pay&&e.$form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),!e.forceSubmit&&a.length&&(t.preventDefault(),t.stopImmediatePropagation(),e.instance.doContinue())},this.updateCheckout=function(t){void 0===t&&(t=null),t&&t.preventDefault(),e.triggerUpdateCheckout()},this.triggerUpdateCheckout=this.debounce(function(){e.$body.trigger("update_checkout")},500),this.onUpdatedCheckout=function(){e.$inputData=jQuery("#wc-ppp-brasil-data"),e.$inputResponse=jQuery("#wc-ppp-brasil-response"),e.$inputError=jQuery("#wc-ppp-brasil-error"),e.$inputSubmit=jQuery("#place_order"),e.$overlay=jQuery("#wc-ppb-brasil-container-overlay"),e.$loading=jQuery("#wc-ppp-brasil-container-loading"),e.$containerDummy=jQuery("#wc-ppp-brasil-container-dummy"),e.$overlay.on("click","[data-action=update-checkout]",e.updateCheckout),e.showOverlay();try{var t=JSON.parse(e.$inputData.val());e.createIframe(t)}catch(e){}},this.messageListener=function(t){try{var a=JSON.parse(t.data);void 0!==a.cause?e.treatIframeError(a):e.treatIframeAction(a)}catch(e){}},this.$body=jQuery(document.body),this.$form=wc_ppp_brasil_data.order_pay?jQuery("form#order_review"):jQuery("form.checkout.woocommerce-checkout"),this.listenInputChanges(),this.$body.on("updated_checkout",this.onUpdatedCheckout),this.$form.on("submit",this.onSubmitForm),window.addEventListener("message",this.messageListener,!1),wc_ppp_brasil_data.order_pay&&jQuery(function(e){jQuery("body").trigger("updated_checkout")})}return e.prototype.listenInputChanges=function(){var e=this,t=["[name=billing_first_name]","[name=billing_last_name]","[name=billing_cpf]","[name=billing_cnpj]","[name=billing_phone]","[name=billing_address_1]","[name=billing_number]","[name=billing_address_2]","[name=billing_neighborhood]","[name=billing_city]","[name=billing_state]","[name=billing_country]","[name=billing_email]"],a=["[name=billing_persontype]"];jQuery(t.join(",")).on("keyup",function(){return e.updateCheckout()}),jQuery(a.join(",")).on("change",function(){return e.updateCheckout()})},e.prototype.createIframe=function(e){if(e.dummy)this.$containerDummy.removeClass("hidden");else{this.hideOverlay(),this.showLoading();var t={approvalUrl:e.approval_url,placeholder:"wc-ppp-brasil-container",mode:wc_ppp_brasil_data.mode,iframeHeight:wc_ppp_brasil_data.form_height,payerFirstName:e.first_name,payerLastName:e.last_name,payerPhone:e.phone,language:wc_ppp_brasil_data.language,country:wc_ppp_brasil_data.country,payerEmail:e.email,rememberedCards:e.remembered_cards};wc_ppp_brasil_data.show_payer_tax_id?(t.payerTaxId="1"===e.person_type?e.cpf:e.cnpj,t.payerTaxIdType="1"===e.person_type?"BR_CPF":"BR_CNPJ"):t.payerTaxId="",this.instance=PAYPAL.apps.PPP(t)}},e.prototype.hideOverlay=function(){this.$overlay.addClass("hidden")},e.prototype.showOverlay=function(){this.$overlay.removeClass("hidden")},e.prototype.hideLoading=function(){this.$loading.addClass("hidden")},e.prototype.showLoading=function(){this.$loading.removeClass("hidden")},e.prototype.treatIframeError=function(e){switch(e.cause.replace(/['"]+/g,"")){case"CHECK_ENTRY":this.showMessage('<div class="woocommerce-error">'+wc_ppp_brasil_data.messages.check_entry+"</div>");break;default:this.$inputError.val(e.cause),this.forceSubmitForm()}},e.prototype.treatIframeAction=function(e){switch(e.action){case"enableContinueButton":this.enableSubmitButton();break;case"disableContinueButton":this.disableSubmitButton();break;case"checkout":this.$inputResponse.val(JSON.stringify(e)),this.forceSubmit=!1,this.forceSubmitForm();break;case"onError":this.$inputResponse.val("");break;case"loaded":this.hideLoading()}},e.prototype.disableSubmitButton=function(){this.$inputSubmit.prop("disabled",!0)},e.prototype.enableSubmitButton=function(){this.$inputSubmit.prop("disabled",!1)},e.prototype.forceSubmitForm=function(){this.forceSubmit=!0,this.$form.submit()},e.prototype.showMessage=function(e){var t=jQuery("form.checkout");jQuery(".woocommerce-error, .woocommerce-message").remove(),e&&(t.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-updateOrderReview">'+e+"</div>"),t.find(".input-text, select, input:checkbox").blur(),jQuery("html, body").animate({scrollTop:t.offset().top-100},1e3))},e.prototype.debounce=function(e,t,a){void 0===a&&(a=!1);var o;return function(){var r=this,i=arguments,n=a&&!o;clearTimeout(o),o=setTimeout(function(){o=null,a||e.apply(r,i)},t),n&&e.apply(r,i)}},e}();new WC_PPP_Brasil_Checkout;